"use strict";window.onload=function(){function e(){resizeCanvas(h,v,f.width,f.height,!1),t()}function t(){f.bgcolor?(v.fillStyle=f.bgcolor,v.fillRect(0,0,h.drawWidth,h.drawHeight)):v.clearRect(0,0,h.drawWidth,h.drawHeight),i=new QuadTree(0,0,h.drawWidth,h.drawHeight),l=0,o=0,s=1,d=2*f.max_r+f.padding,m=0,p=new Array(10*f.inactivity),g=0,u=0,c=0,M.status.innerHTML="Running",M.level.innerHTML=s}function n(){"alternate"==f.pattern?bestp%2?f.bgcolor?v.fillStyle=f.bgcolor:v.globalCompositeOperation="destination-out":f.maincolor?v.fillStyle=f.maincolor:v.fillStyle=randomColor():"rainbow"==f.pattern&&(v.fillStyle=getSaturatedColor(bestp/6))}function a(){if(l<f.inactivity){for(var e,t,r=-1/0,w=0;w<f.samples;w++){for(var T=Math.random()*h.drawWidth,x=Math.random()*h.drawHeight,$=0,H=i.inRegion(T-d,x-d,T+d,x+d),L=1/0,k=1/0,y=0;y<H.length;y++){var _=T-H[y].x,C=x-H[y].y,I=Math.sqrt(_*_+C*C)-H[y].r,S=Math.abs(I);I<0&&H[y].r<k&&($=H[y].p+1,k=H[y].r),S<L&&(L=S)}$==s-1&&L>r&&(r=L,e=T,t=x,bestp=$)}if(r>f.min_r+f.padding){v.beginPath(),v.arc(e,t,Math.min(f.max_r,r-f.padding),0,2*Math.PI),v.closePath(),n(),v.fill(),v.globalCompositeOperation="source-over";var B={x:e,y:t,r:Math.min(f.max_r,r-f.padding),p:bestp,color:randomColor()};B.r>m&&(m=B.r),i.insert(B),l=0,M.points.innerHTML=++o}else l++;var N=p[g];p[g]=l?1:0,N&&(u-=N),u+=p[g],g=(g+1)%p.length;var R=u/p.length;c=Math.clamp(Math.floor(130*Math.sqrt(R)/Math.sqrt(26-25*R)),c,99),M.progress.innerHTML=c+"%"}else s!=f.maxlevel&&m>0?(s++,l=0,d=m,m=0,p=new Array(1e3),g=0,u=0,c=0,M.status.innerHTML="Running",M.level.innerHTML=s):(M.status.innerHTML="Done",M.progress.innerHTML="100%");b||setTimeout(a,0)}function r(e){e&&!b?b=e:!e&&b&&(b=e,a()),w.pauseBtn.innerHTML=b?"Resume":"Pause"}var i,l,o,s,d,m,p,g,u,c,h=$("draw-canvas"),v=h.getContext("2d"),b=!0,f={width:3e3,height:3e3,samples:30,padding:12,min_r:6,max_r:300,maxlevel:-1,inactivity:100,pattern:"alternate",bgcolor:null,maincolor:null},w={pauseBtn:$("pause"),resetBtn:$("reset"),saveBtn:$("save-btn"),saveImg:$("save-img"),width:$("width"),height:$("height"),samples:$("samples"),padding:$("padding"),min_r:$("min-rad"),max_r:$("max-rad"),maxlevel:$("max-level"),bgcolor:$("bg-color"),pattern:$("pattern")},M={status:$("status"),level:$("level"),points:$("points"),progress:$("progress")};!function(){scaleCanvas(h,v),fitElement(h),w.pauseBtn.addEventListener("click",function(){r(!b)}),w.resetBtn.addEventListener("click",t),w.saveBtn.addEventListener("click",function(){w.saveImg.src=h.toDataURL()}),linkInputToNumber(w.width,f,"width",e,!1),linkInputToNumber(w.height,f,"height",e,!1),linkInputToNumber(w.samples,f,"samples",t,!1),linkInputToNumber(w.padding,f,"padding",t,!1),linkInputToNumber(w.min_r,f,"min_r",t,!1),linkInputToNumber(w.max_r,f,"max_r",t,!1),linkInputToNumber(w.maxlevel,f,"maxlevel",t,!1),linkColorChooserToHexString(w.bgcolor,f,"bgcolor",t),linkSelectToString(w.pattern,f,"pattern",t),e(),r(!1)}()};