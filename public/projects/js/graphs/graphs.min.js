"use strict";window.onload=function(){function e(){var e=B.background&&(F.background||(F.edgesChanged||F.deselection)&&(B.constantUpdates||!F.mouseMotion&&!F.mousePress)||F.orderChanged),o=F.graph||F.nodesChanged||F.edgesChanged,t=B.edgeDists&&(F.mouseMotion||F.mouseEnter||F.mouseLeave);if(F.setAll(!1),e&&A&&m.length<=16?R||(R=!0,window.requestAnimFrame(n)):B.background||L.clear(L.COLOR_BUFFER_BIT),(o||t)&&(E.clearRect(0,0,x.drawWidth,x.drawHeight),B.showEdges&&m.forEach(function(e){E.beginPath(),E.moveTo(e.a.x,e.a.y),E.lineTo(e.b.x,e.b.y),E.closePath(),E.strokeStyle=e.color,E.lineWidth=B.edgeWidth,E.stroke()}),B.showNodes&&f.forEach(function(e){E.beginPath(),E.arc(e.x,e.y,B.nodeSize,0,2*Math.PI),E.closePath(),E.fillStyle="#000000",E.strokeStyle="#FFFFFF",E.lineWidth=1,E.fill(),E.stroke()}),B.edgeDists&&C.inside))for(var i=0;i<m.length;i++){var s=m[i].distance(C);E.beginPath(),E.arc(C.x,C.y,s,0,2*Math.PI),E.closePath(),E.strokeStyle=m[i].color,E.lineWidth=1,E.stroke()}}function n(){L.clear(L.COLOR_BUFFER_BIT),L.uniform1i(T.nEdges,m.length),L.uniform1i(T.order,B.order),L.uniform1f(T.range,B.range),L.uniform1f(T.highlight,B.highlight?1:0),L.uniform1f(T.modulo,B.modulo?1:0);for(var e=0;e<m.length;e++){var n=m[e];L.uniform4fv(T.edges[e],new Float32Array([n.a.x,x.drawHeight-n.a.y,n.b.x,x.drawHeight-n.b.y]))}L.bindBuffer(L.ARRAY_BUFFER,y),L.enableVertexAttribArray(v),L.vertexAttribPointer(v,2,L.FLOAT,!1,0,0),L.drawArrays(L.TRIANGLES,0,6),R=!1}function o(){F.graph=!0,e()}function t(){F.background=!0,e()}function i(){for(var e,n=Number.POSITIVE_INFINITY,o=0;o<f.length;o++)(e=f[o].distance(C))<n&&(n=e,k=f[o])}function s(e,n){this.x=e,this.y=n}function r(e,n,o){this.a=e,this.b=n,this.color=o}function a(n){takeTouchFocus(n);var o=getRelativeCoord(x,n);if(C.x=o.x,C.y=o.y,k.nearby(C,B.nodeSize)&&(b=k,F.selection=!0),n.ctrlKey||n.metaKey)if(null===b)k=new s(C.x,C.y,10),f.push(k),F.nodesChanged=!0;else{var t=new s(C.x,C.y,10);w=new r(t,b,randomColor()),b=t,m.push(w),F.edgesChanged=!0}F.mousePress=!0,e()}function d(n){takeTouchFocus(n),null!==w&&(k.nearby(C,B.nodeSize)?(w.a=k,F.edgesChanged=!0):(f.push(b),k=b,F.nodesChanged=!0),w=null),null!==b&&(F.deselection=!0),F.mouseRelease=!0,b=null,e()}function h(n){takeTouchFocus(n);var o=getRelativeCoord(x,n);C.x=o.x,C.y=o.y,i(),null!==b&&(b.move(C),F.nodesChanged=!0,F.edgesChanged=!0),F.mouseMotion=!0,e()}function l(n){if(81==n.keyCode)if(k.nearby(C,B.nodeSize)){var o=f.indexOf(k);f.splice(o,1),F.nodesChanged=!0;for(var t=0;t<m.length;t++){var s=m[t];s.a!=k&&s.b!=k||(m.splice(t,1),F.edgesChanged=!0,t--)}i()}else for(var t=0;t<m.length;t++){var r=m[t].distance(C);if(r<4){m.splice(t,1),F.edgesChanged=!0;break}}e()}function c(n){C.inside=!0,F.mouseEnter=!0,e()}function u(e){C.inside=!1,F.mouseLeave=!0,d(e)}function g(e,n,o){for(var t=[],i=[],a=0;a<o;a++){var d=new s(e/2+Math.sin(2*Math.PI*a/o)*(e/4),n/2+Math.cos(2*Math.PI*a/o)*(n/4));t[a]=d;for(var h=0;h<a;h++)i[i.length]=new r(d,t[h],randomColor())}return{nodes:t,edges:i}}var f,m,v,y,k,b,w,C,x=$("draw-canvas"),p=$("gl-canvas"),E=x.getContext("2d"),L=getGL(p,{preserveDrawingBuffer:!0}),F={mouseMotion:!1,mousePress:!1,mouseRelease:!1,mouseEnter:!1,mouseLeave:!1,nodesChanged:!1,edgesChanged:!1,orderChanged:!1,selection:!1,deselection:!1,graph:!1,background:!1,setAll:function(e){this.mouseMotion=this.mousePress=this.mouseRelease=this.mouseEnter=this.mouseLeave=this.nodesChanged=this.edgesChanged=this.orderChanged=this.selection=this.deselection=this.graph=this.background=e}},T={edges:[],nEdges:null,order:null,range:null,highlight:null,modulo:null,scale:null},A=!1,R=!1,B={nodeSize:10,edgeWidth:1,order:4,range:250,showNodes:!0,showEdges:!0,background:!0,edgeDists:!1,highlight:!0,modulo:!1,constantUpdates:!0},P={orderinput:$("orderinput"),rangeinput:$("rangeinput"),sncheck:$("shownodes"),secheck:$("showedges"),bgcheck:$("background"),edcheck:$("edgedists"),hlcheck:$("highlight"),mocheck:$("modulo"),upcheck:$("updates")};!function(){scaleCanvas(x,E);var n=scaleCanvas(p,L),i=$("canvases");fitElement(i,i.clientWidth,i.clientHeight,function(e){x.style.width=p.style.width=i.style.width,x.style.height=p.style.height=i.style.height});var s=(x.drawWidth,x.drawHeight,g(x.drawWidth,x.drawHeight,4));f=s.nodes,m=s.edges,loadFiles(["shader.vert","shader.frag"],function(e){var o=getGLProgram(L,e[0],e[1]);L.useProgram(o),v=L.getAttribLocation(o,"position");for(var i=0;i<16;i++)T.edges[i]=L.getUniformLocation(o,"edges["+i+"]");T.nEdges=L.getUniformLocation(o,"num_edges"),T.order=L.getUniformLocation(o,"order"),T.range=L.getUniformLocation(o,"range"),T.highlight=L.getUniformLocation(o,"highlight"),T.modulo=L.getUniformLocation(o,"modulo"),T.scale=L.getUniformLocation(o,"scale"),L.uniform1f(T.scale,n),A=!0,t()},function(e){console.log("Couldn't find file: "+e)}),y=L.createBuffer(),L.bindBuffer(L.ARRAY_BUFFER,y),L.bufferData(L.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),L.STATIC_DRAW),L.viewport(0,0,L.drawingBufferWidth,L.drawingBufferHeight),L.clearColor(0,0,0,0),F.setAll(!0),k=null,b=null,w=null,C={x:0,y:0,inside:!1},linkInputToNumber(P.orderinput,B,"order",t),linkInputToNumber(P.rangeinput,B,"range",t),linkCheckboxToBoolean(P.sncheck,B,"showNodes",o),linkCheckboxToBoolean(P.secheck,B,"showEdges",o),linkCheckboxToBoolean(P.bgcheck,B,"background",t),linkCheckboxToBoolean(P.edcheck,B,"edgeDists"),linkCheckboxToBoolean(P.hlcheck,B,"highlight",t),linkCheckboxToBoolean(P.mocheck,B,"modulo",t),linkCheckboxToBoolean(P.upcheck,B,"constantUpdates"),x.addEventListener("mousedown",a),x.addEventListener("mouseup",d),x.addEventListener("mouseenter",c),x.addEventListener("mouseleave",u),x.addEventListener("mousemove",h),x.addEventListener("touchstart",a),x.addEventListener("touchend",u),x.addEventListener("touchmove",h),window.addEventListener("keydown",l),e()}(),s.prototype.distance=function(e){var n=e.x-this.x,o=e.y-this.y;return Math.sqrt(n*n+o*o)},s.prototype.nearby=function(e,n){var o=e.x-this.x,t=e.y-this.y;return o*o+t*t<n*n},s.prototype.move=function(e){this.x=e.x,this.y=e.y},r.prototype.distance=function(e){var n=this.b.x-this.a.x,o=this.b.y-this.a.y,t=n*n+o*o,i=e.x-this.a.x,s=e.y-this.a.y,r=e.x-this.b.x,a=e.y-this.b.y,d=n*i+o*s;return d<=0?Math.sqrt(i*i+s*s):d>=t?Math.sqrt(r*r+a*a):Math.sqrt(i*i+s*s-d*d/t)}};