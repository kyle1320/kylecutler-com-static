"use strict";function Cloth(t){function i(t,i,h,a,v){this.x=t,this.y=i,this.lx=t,this.ly=i,this.ax=0,this.ay=0,this.pinned=h||!1,this.px=void 0===a?t:a,this.py=void 0===v?i:v,this.links=[],this.update=function(t){this.interaction(),this.applyForce(0,o);var i=(this.x-this.lx)*(1-l),s=(this.y-this.ly)*(1-l);this.lx=this.x,this.ly=this.y,this.x+=i+.5*this.ax*t*t,this.y+=s+.5*this.ay*t*t,this.ax=0,this.ay=0},this.applyForce=function(t,i){this.ax+=t,this.ay+=i},this.interaction=function(){if(u&&d){var t=u.x-this.x,i=u.y-this.y;Math.sqrt(t*t+i*i)<c&&this.applyForce(d.x*r,d.y*r)}},this.constraints=function(){for(var t=0;t<this.links.length;t++)this.links[t].solve(),this.links[t].broken&&this.links.splice(t,1);this.x<x&&(this.x=x),this.x>n-x&&(this.x=n-x),this.y<x&&(this.y=x),this.y>e-x&&(this.y=e-x),h&&(this.x=this.px,this.y=this.py)},this.attachTo=function(t,i,n){this.links[this.links.length]=new s(this,t,i,n)}}function s(t,i,s,n){if(void 0===s){var e=t.x-i.x,h=t.y-i.y;s=Math.sqrt(e*e+h*h)}void 0===n&&(n=1),this.a=t,this.b=i,this.restingDist=s,this.tearDist=s*(n+1),this.broken=!1,this.solve=function(){var n=this.a.x-this.b.x,e=this.a.y-this.b.y,h=Math.sqrt(n*n+e*e),o=(this.restingDist-h)/h;if(h>this.tearDist&&(this.broken=!0),!(h<s)){var l=n*a/2*o,c=e*a/2*o;t.x+=l,t.y+=c,i.x-=l,i.y-=c}}}this.canvas=t,this.context=t.getContext("2d"),this.points=[],this.paused=!0,scaleCanvas(this.canvas,this.context);var n=t.clientWidth,e=t.clientHeight,h=this,o=400,a=1,l=.01,c=20,r=2e3,x=50,u=null,d=null,v=document.getElementById("pause"),y=document.getElementById("reset");v.addEventListener("click",function(){h.setPaused(!h.paused)}),y.addEventListener("click",function(){h.reset()}),this.setPaused=function(t){t&&!this.paused?clearInterval(this.runInterval):this.paused&&(this.runInterval=setInterval(function(){h.update(.015)},15)),this.paused=t,v.innerHTML=t?"Resume":"Pause"},this.getRelativeCoord=function(i){var s=t.getBoundingClientRect();return{x:i.clientX-s.left,y:i.clientY-s.top}},this.draw=function(){this.context.clearRect(0,0,this.canvas.clientWidth,this.canvas.clientHeight);for(var t=0;t<this.points.length;t++){for(var i=0;i<this.points[t].links.length;i++)this.context.beginPath(),this.context.moveTo(this.points[t].links[i].a.x,this.points[t].links[i].a.y),this.context.lineTo(this.points[t].links[i].b.x,this.points[t].links[i].b.y),this.context.closePath(),this.context.strokeStyle="#000000",this.context.stroke();this.context.beginPath(),this.context.arc(this.points[t].x,this.points[t].y,2,0,2*Math.PI),this.context.closePath(),this.context.fillStyle="#000000",this.context.fill()}u&&(this.context.globalAlpha=.2,this.context.beginPath(),this.context.arc(u.x,u.y,c,0,2*Math.PI),this.context.closePath(),this.context.fillStyle="#0000FF",this.context.fill(),this.context.globalAlpha=1)},this.update=function(t){for(var i=0;i<3;i++)for(var s=0;s<this.points.length;s++)this.points[s].constraints();this.points.forEach(function(i){i.update(t)}),this.draw()},this.reset=function(){this.points=[],this.initializePoints()},this.initializePoints=function(){for(var t=0,s=0;s<20;s++)for(var n=0;n<20;n++)this.points[t]=new i(8*n+x,8*s+x,0==s),n>0&&this.points[t].attachTo(this.points[t-1]),s>0&&this.points[t].attachTo(this.points[t-20]),t++},this.initializePoints(),t.addEventListener("mousedown",function(t){var i=h.getRelativeCoord(t);u&&(d={x:i.x-u.x,y:i.y-u.y}),u=i}),t.addEventListener("mousemove",function(t){if(u){var i=h.getRelativeCoord(t);d={x:i.x-u.x,y:i.y-u.y},u=i}}),t.addEventListener("mouseup",function(t){u=d=null}),t.addEventListener("mouseleave",function(t){u=d=null})}function scaleCanvas(t,i){var s=window.devicePixelRatio||1,n=i.webkitBackingStorePixelRatio||i.mozBackingStorePixelRatio||i.msBackingStorePixelRatio||i.oBackingStorePixelRatio||i.backingStorePixelRatio||1,e=s/n;t.style.width=t.width+"px",t.style.height=t.height+"px",t.width*=e,t.height*=e,i.scale(e,e)}var cloth;window.onload=function(){var t=document.getElementById("drawCanvas");cloth=new Cloth(t),cloth.setPaused(!1)};