"use strict";window.onload=function(){function e(e,n){resizeCanvas(u,v,e,n,!1),console.log(u.width,u.height),t()}function t(){b.bgcolor?(v.fillStyle=b.bgcolor,v.fillRect(0,0,u.drawWidth,u.drawHeight)):v.clearRect(0,0,u.drawWidth,u.drawHeight),i=new QuadTree(0,0,u.drawWidth,u.drawHeight),o=0,l=0,s=1,d=2*b.max_rad+b.padding,g=0,c=new Array(10*b.inactivity),p=0,m=0,h=0,T.status.innerHTML="Running",T.level.innerHTML=s,T.points.innerHTML=l,T.progress.innerHTML=h+"%"}function n(){"alternate"==b.pattern?s%2?b.maincolor?v.fillStyle=b.maincolor:v.fillStyle=randomColor():b.bgcolor?v.fillStyle=b.bgcolor:v.globalCompositeOperation="destination-out":"rainbow"==b.pattern&&(v.fillStyle=getSaturatedColor((s-1)/6))}function r(){if(o<b.inactivity){for(var e,t,a,w=-1/0,M=0;M<b.samples;M++){for(var x=Math.random()*u.drawWidth,$=Math.random()*u.drawHeight,y=0,H=i.inRegion(x-d,$-d,x+d,$+d),L=1/0,k=1/0,_=0;_<H.length;_++){var C=x-H[_].x,I=$-H[_].y,S=Math.sqrt(C*C+I*I)-H[_].r,B=Math.abs(S);S<0&&H[_].r<k&&(y=H[_].p+1,k=H[_].r),B<L&&(L=B)}y==s-1&&L>w&&(w=L,e=x,t=$,a=y)}if(w>b.min_rad+b.padding){var N={x:e,y:t,r:Math.min(b.max_rad,w-b.padding),p:a,color:randomColor()};v.beginPath(),v.arc(N.x,N.y,N.r,0,2*Math.PI),v.closePath(),n(),v.fill(),v.globalCompositeOperation="source-over",i.insert(N),N.r>g&&(g=N.r),o=0,T.points.innerHTML=++l}else o++;var P=c[p];c[p]=o?1:0,P&&(m-=P),m+=c[p],p=(p+1)%c.length;var R=m/c.length,E=Math.sqrt(R)/Math.sqrt(26-25*R);h=Math.clamp(Math.floor(130*E),h,99),T.progress.innerHTML=h+"%"}else s!=b.maxlevel&&g>0?(s++,o=0,d=g,g=0,c=new Array(1e3),p=0,m=0,h=0,T.level.innerHTML=s):(T.status.innerHTML="Done",T.progress.innerHTML="100%");f||setTimeout(r,0)}function a(e){e&&!f?f=e:!e&&f&&(f=e,r()),w.pauseBtn.innerHTML=f?"Resume":"Pause"}var i,o,l,s,d,g,c,p,m,h,u=$("draw-canvas"),v=u.getContext("2d"),f=!0,b={samples:30,padding:4,min_rad:2,max_rad:100,maxlevel:-1,inactivity:100,pattern:"alternate",bgcolor:"#F36E21",maincolor:""},w={pauseBtn:$("pause"),resetBtn:$("reset"),saveBtn:$("save-btn"),saveImg:$("save-img"),width:$("width"),height:$("height"),samples:$("samples"),padding:$("padding"),min_rad:$("min-rad"),max_rad:$("max-rad"),maxlevel:$("max-level"),bgcolor:$("bg-color"),pattern:$("pattern")},T={status:$("status"),level:$("level"),points:$("points"),progress:$("progress")};!function(){scaleCanvas(u,v,!1),fitElement(u),Object.defineProperty(b,"width",{get:function(){return u.width},set:function(t){e(t,u.height)}}),Object.defineProperty(b,"height",{get:function(){return u.height},set:function(t){e(u.width,t)}}),w.pauseBtn.addEventListener("click",function(){a(!f)}),w.resetBtn.addEventListener("click",t),w.saveBtn.addEventListener("click",function(){w.saveImg.src=u.toDataURL()}),linkInputToNumber(w.width,b,"width",null,!1),linkInputToNumber(w.height,b,"height",null,!1),linkInputToNumber(w.samples,b,"samples",t,!1),linkInputToNumber(w.padding,b,"padding",t,!1),linkInputToNumber(w.min_rad,b,"min_rad",t,!1),linkInputToNumber(w.max_rad,b,"max_rad",t,!1),linkInputToNumber(w.maxlevel,b,"maxlevel",t,!1),linkColorChooserToHexString(w.bgcolor,b,"bgcolor",t),linkSelectToString(w.pattern,b,"pattern",t),t(),a(!1)}()};