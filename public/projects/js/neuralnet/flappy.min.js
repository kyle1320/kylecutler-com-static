"use strict";function FlappyGame(){this.reset(),this.num_inputs=4,this.num_outputs=1}function drawMessage(t,e,a,r){t.strokeStyle="#FFFFFF",t.strokeText(e,a,r),t.fillStyle="#000000",t.fillText(e,a,r)}FlappyGame.prototype.reset=function(){this.player_x=0,this.player_y=.5,this.player_vx=.3,this.player_vy=0,this.gates={front:null,rear:null},this.jumped=0,this.running=!0},FlappyGame.prototype.update=function(t){if(this.running){if(t){var e=this.nearestGate();t.input(e.x-this.player_x,e.y-this.player_y,this.player_y,this.player_vx),t.output(0)>=.5&&this.jump()}this.player_vy+=.015,this.player_x+=.01*this.player_vx,this.player_y+=.01*this.player_vy,this.player_x>1e4&&(this.running=!1),(!this.gates.rear||this.gates.rear.x-this.player_x<.8)&&(this.gates.rear?(this.gates.rear.next={x:this.gates.rear.x+1.5*this.player_vx,y:.85*Math.random()+0,next:null},this.gates.rear=this.gates.rear.next):this.gates.front=this.gates.rear={x:this.player_x+1.5*this.player_vx,y:.85*Math.random()+0,next:null}),(this.player_y<.02||this.player_y>.98)&&(this.running=!1),this.gates.front&&this.player_x-this.gates.front.x>.05&&(this.jumped++,this.gates.front=this.gates.front.next,this.gates.front||(this.gates.rear=null));for(var a=this.gates.front;a;){var r=this.player_x-a.x;if(Math.abs(r)<.02){var s=this.player_y-a.y,i=Math.sqrt(4e-4-r*r);if(s<i||s>.15-i){this.running=!1;break}}a=a.next}}},FlappyGame.prototype.run=function(t){for(this.reset();this.running;)this.update(t);t.fitness=this.player_x},FlappyGame.prototype.jump=function(){this.player_vy=-.7},FlappyGame.prototype.nearestGate=function(){for(var t=this.gates.front;t;){if(t.x>this.player_x-.02)return t;t=t.next}return{x:this.player_x+1,y:.5}},FlappyGame.prototype.draw=function(t,e){e.clearRect(0,0,t.drawWidth,t.drawHeight),e.beginPath(),e.arc(.2*t.drawWidth,this.player_y*t.drawHeight,.02*t.drawHeight,0,2*Math.PI),e.closePath(),e.fillStyle="#000000",e.fill();for(var a=this.gates.front;a;){var r=(a.x-this.player_x+.2)*t.drawWidth,s=a.y*t.drawHeight;a=a.next,r<0||r>t.drawWidth||(e.beginPath(),e.moveTo(r,0),e.lineTo(r,s),e.moveTo(r,s+.15*t.drawHeight),e.lineTo(r,t.drawHeight),e.strokeStyle="#000000",e.stroke())}if(e.font="15px Verdana",drawMessage(e,"Distance: "+this.player_x.toFixed(2),0,15),drawMessage(e,"Gates jumped: "+this.jumped,0,35),!this.running){var i=.1*t.drawWidth;e.fillStyle="#FF0000",e.fillRect(3*i,2*i,1.5*i,6*i),e.fillRect(5.5*i,2*i,1.5*i,6*i);var h="press space to restart";drawMessage(e,h,3*i+(4*i-e.measureText(h).width)/2,8*i+20)}},FlappyGame.prototype.keyPressed=function(t){switch(t.keyCode){case 32:t.preventDefault(),this.running?this.jump():this.reset()}};