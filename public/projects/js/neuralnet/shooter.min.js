"use strict";function ShooterGame(){this.reset(),this.num_inputs=7,this.num_outputs=2}ShooterGame.prototype.reset=function(){this.player_x=.5,this.player_vx=0,this.bullet_countdown=0,this.bullets={front:null,rear:null},this.enemies=[],this.score=0,this.time=0,this.running=!0;for(var e=0;e<3;e++)this.enemies[e]={x:Math.random(),v:Math.random()-.5}},ShooterGame.prototype.update=function(e){if(this.running){e&&(e.input(this.enemies[0].x,this.enemies[1].x,this.enemies[2].x,this.enemies[0].v,this.enemies[1].v,this.enemies[2].v,this.player_x),e.outputs[0].value<=.3&&this.left(),e.outputs[0].value>=.7&&this.right(),e.outputs[1].value>=.5&&this.fire()),this.player_x+=.01*this.player_vx,this.player_vx=0,this.bullet_countdown--,this.time++,this.time>3e3&&(this.running=!1),this.player_x>.98&&(this.player_x=.98),this.player_x<.02&&(this.player_x=.02);for(var t,i=this.bullets.front;i;){if(i.y-=.01,i.y<=0)i==this.bullets.front?this.bullets.front=this.bullets.front.next:i==this.bullets.rear&&(this.bullets.rear=this.bullets.rear.prev),i.prev&&(i.prev.next=i.next),i.next&&(i.next.prev=i.prev);else if(Math.abs(i.y-.04)<.02)for(t=0;t<this.enemies.length;t++)Math.abs(this.enemies[t].x-i.x)<.02&&(this.enemies[t].x=Math.random(),this.enemies[t].v=Math.random()-.5,this.score++,i==this.bullets.front?this.bullets.front=this.bullets.front.next:i==this.bullets.rear&&(this.bullets.rear=this.bullets.rear.prev),i.prev&&(i.prev.next=i.next),i.next&&(i.next.prev=i.prev));i=i.next}for(t=0;t<this.enemies.length;t++)this.enemies[t].x+=.01*this.enemies[t].v,this.enemies[t].x<.05&&(this.enemies[t].x=.1-this.enemies[t].x,this.enemies[t].v=-this.enemies[t].v),this.enemies[t].x>.95&&(this.enemies[t].x=1.9-this.enemies[t].x,this.enemies[t].v=-this.enemies[t].v)}},ShooterGame.prototype.run=function(e){for(this.reset();this.running;)this.update(e);e.fitness=this.score},ShooterGame.prototype.draw=function(e,t){t.clearRect(0,0,e.drawWidth,e.drawHeight),t.fillStyle="#000000",t.fillRect((this.player_x-.02)*e.drawWidth,.94*e.drawHeight,.04*e.drawWidth,.04*e.drawHeight);for(var s=this.bullets.front;s;)t.fillStyle="#FF0000",t.fillRect((s.x-.01)*e.drawWidth,(s.y-.01)*e.drawHeight,.02*e.drawWidth,.02*e.drawHeight),s=s.next;for(i=0;i<this.enemies.length;i++)t.fillStyle="#000000",t.fillRect((this.enemies[i].x-.02)*e.drawWidth,.02*e.drawHeight,.04*e.drawWidth,.04*e.drawHeight)},ShooterGame.prototype.left=function(){this.player_vx=-1},ShooterGame.prototype.right=function(){this.player_vx=1},ShooterGame.prototype.fire=function(){this.bullet_countdown<=0&&(this.bullets.rear?(this.bullets.rear.next={x:this.player_x,y:.95,next:null,prev:this.bullets.rear},this.bullets.rear=this.bullets.rear.next):this.bullets.front=this.bullets.rear={x:this.player_x,y:.95,next:null,prev:null},this.bullet_countdown=50)},ShooterGame.prototype.keyPressed=function(e){switch(e.keyCode){case 37:e.preventDefault(),this.running?this.left():this.reset();break;case 38:e.preventDefault(),this.running?this.fire():this.reset();break;case 39:e.preventDefault(),this.running?this.right():this.reset()}};