"use strict";window.onload=function(){function e(e,t){e=e||function(){},t=t||function(){};for(var n,i=d.drawWidth/2,a=i,r=i,s=0,l=0,c=0,o=0;o<v.length;o++)n=v[o],l=s-n.angle,s+=(c/n.radius-1)*n.angle,o>0&&(a+=i*(c-n.radius)*Math.cos(l),r+=i*(c-n.radius)*Math.sin(l)),o==v.length-1&&(n.penx=a+n.radius*i*m.penDist*Math.cos(s),n.peny=r+n.radius*i*m.penDist*Math.sin(s)),n.x=a,n.y=r,n.realangle=s%(2*Math.PI),n.realradius=n.radius*i,e(n),c=n.radius;t(v[o-1])}function t(){h.clearRect(0,0,u.drawWidth,u.drawHeight),(m.showCircles||m.showRadii||m.showPen)&&e(function(e){m.showCircles&&(h.strokeStyle="#000000",h.beginPath(),h.arc(e.x,e.y,Math.abs(e.realradius),0,2*Math.PI),h.closePath(),h.stroke()),m.showRadii&&(h.strokeStyle="#00FF00",h.beginPath(),h.moveTo(e.x,e.y),h.lineTo(e.x+Math.cos(e.realangle)*e.realradius,e.y+Math.sin(e.realangle)*e.realradius),h.closePath(),h.stroke())},function(e){m.showPen&&(h.fillStyle="#FF0000",h.beginPath(),h.arc(e.penx,e.peny,2,0,360),h.closePath(),h.fill())})}function n(e){e<=0||(m.speed=e,g.speedInput.valueAsNumber=e)}function i(e){e<=0||(m.iterations=e,g.iterInput.valueAsNumber=e)}function a(e){e&&!f?clearInterval(o):f&&(o=setInterval(function(){k(.015)},15)),f=e,g.pauseBtn.innerHTML=e?"Resume":"Pause"}function r(){v.forEach(function(e){e.angle=0}),p.clearRect(0,0,d.drawWidth,d.drawHeight),t()}function s(e){var n=v.indexOf(e);v.splice(n,1),c(),t()}function l(e){var n=e>0?v[e-1].radius/2:1,i=e>0?v[e-1].speed/2||1:0,a={radius:n,angle:0,speed:i};v.splice(e,0,a),c(),t()}function c(){for(;g.circleDiv.firstChild;)g.circleDiv.removeChild(g.circleDiv.firstChild);for(var e,n=0;n<v.length;n++){var i=v[n];if(e=document.createElement("button"),e.innerHTML="+",e.addEventListener("click",l.bind(null,n)),e.style.width="100%",i.div)i.div.getElementsByTagName("div")[0].innerHTML="Circle "+n+":";else{var a=document.createElement("div"),r=document.createElement("div");r.innerHTML="Circle "+n+":",r.style.textAlign="center";var c=document.createElement("div"),o=document.createElement("input");o.setAttribute("type","number"),o.setAttribute("step","0.05"),o.style.float="right",linkInputToNumber(o,i,"radius",t);var d=document.createElement("br");d.style.clear="right",c.innerHTML="Radius: ",c.appendChild(o),c.appendChild(d);var u=document.createElement("div"),p=document.createElement("input");p.setAttribute("type","number"),p.setAttribute("step","0.01"),p.style.float="right",linkInputToNumber(p,i,"speed",t),d=document.createElement("br"),d.style.clear="right",u.innerHTML="Speed: ",u.appendChild(p),u.appendChild(d);var h=document.createElement("button");h.innerHTML="delete",h.addEventListener("click",s.bind(null,i)),h.style.width="100%",a.appendChild(r),a.appendChild(c),a.appendChild(u),a.appendChild(h),a.style.border="2px solid black",a.style.padding="4px",a.style.margin="10px",i.div=a}g.circleDiv.appendChild(e),g.circleDiv.appendChild(i.div)}e=document.createElement("button"),e.innerHTML="+",e.addEventListener("click",l.bind(null,v.length)),e.style.width="100%",g.circleDiv.appendChild(e)}var o,d=$("spiro-canvas"),u=$("info-canvas"),p=d.getContext("2d"),h=u.getContext("2d"),v=[{radius:1,angle:0,speed:0},{radius:.5,angle:0,speed:1},{radius:.25,angle:0,speed:1/Math.PI}],f=!0,m={iterations:100,speed:5,penDist:0,showCircles:!0,showRadii:!1,showPen:!0,useColor:!0},g={speedInput:$("speed-input"),iterInput:$("iter-input"),penDistInput:$("pendist-input"),sccheck:$("show-circles"),srcheck:$("show-radii"),spcheck:$("show-pen"),uccheck:$("use-color"),pauseBtn:$("pause-btn"),resetBtn:$("reset-btn"),circleDiv:$("circles"),saveBtn:$("save-btn"),saveImg:$("save-img")};!function(){scaleCanvas(d,p),scaleCanvas(u,h);var e=$("canvases");fitElement(e,e.clientWidth,e.clientHeight,function(t){d.style.width=u.style.width=e.style.width,d.style.height=u.style.height=e.style.height}),linkInputToNumber(g.speedInput,m,"speed"),linkInputToNumber(g.iterInput,m,"iterations"),linkInputToNumber(g.penDistInput,m,"penDist",t),linkCheckboxToBoolean(g.sccheck,m,"showCircles",t),linkCheckboxToBoolean(g.srcheck,m,"showRadii",t),linkCheckboxToBoolean(g.spcheck,m,"showPen",t),linkCheckboxToBoolean(g.uccheck,m,"useColor"),g.pauseBtn.addEventListener("click",function(){a(!f)}),g.resetBtn.addEventListener("click",function(){r()}),g.saveBtn.addEventListener("click",function(){g.saveImg.src=d.toDataURL()}),window.addEventListener("keydown",function(e){switch(e.keyCode){case 32:a(!f),e.preventDefault();break;case 39:n(1.1*m.speed),e.preventDefault();break;case 37:n(m.speed/1.1),e.preventDefault();break;case 187:i(m.iterations+10),e.preventDefault();break;case 189:i(m.iterations-10),e.preventDefault();break;case 13:r(),e.preventDefault()}}),c(),a(!1)}();var k=function(){var n,i,a,r,s,l,c,o=function(e){n=e.penx,i=e.peny},d=function(e){e.angle+=m.speed*e.speed*c},u=function(e){a=e.penx,r=e.peny,s=e.realradius,l=e.realangle};return function(s){c=s/m.iterations,e(null,o);for(var h=0;h<m.iterations;h++)v.forEach(d),e(null,u),p.strokeStyle=m.useColor?getSaturatedColor(l/(2*Math.PI)):"#000000",p.beginPath(),p.moveTo(n,i),p.lineTo(a,r),p.closePath(),p.stroke(),n=a,i=r;t()}}()};