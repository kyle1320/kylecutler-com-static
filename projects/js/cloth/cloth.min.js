function Cloth(t){function i(t,i,h,a,c){this.x=t,this.y=i,this.lx=t,this.ly=i,this.ax=0,this.ay=0,this.pinned=h||!1,this.px=void 0===a?t:a,this.py=void 0===c?i:c,this.links=[],this.update=function(t){this.interaction(),this.applyForce(0,o);var i=(this.x-this.lx)*(1-l),s=(this.y-this.ly)*(1-l);this.lx=this.x,this.ly=this.y,this.x+=i+.5*this.ax*t*t,this.y+=s+.5*this.ay*t*t,this.ax=0,this.ay=0},this.applyForce=function(t,i){this.ax+=t,this.ay+=i},this.interaction=function(){if(d&&v){var t=d.x-this.x,i=d.y-this.y,s=Math.sqrt(t*t+i*i);r>s&&this.applyForce(v.x*x,v.y*x)}},this.constraints=function(){for(var t=0;t<this.links.length;t++)this.links[t].solve(),this.links[t].broken&&this.links.splice(t,1);this.x<u&&(this.x=u),this.x>n-u&&(this.x=n-u),this.y<u&&(this.y=u),this.y>e-u&&(this.y=e-u),h&&(this.x=this.px,this.y=this.py)},this.attachTo=function(t,i,n){this.links[this.links.length]=new s(this,t,i,n)}}function s(t,i,s,n){if(void 0===s){var e=t.x-i.x,h=t.y-i.y;s=Math.sqrt(e*e+h*h)}void 0===n&&(n=1),this.a=t,this.b=i,this.restingDist=s,this.tearDist=s*(n+1),this.broken=!1,this.solve=function(){var n=this.a.x-this.b.x,e=this.a.y-this.b.y,h=Math.sqrt(n*n+e*e),o=(this.restingDist-h)/h;if(h>this.tearDist&&(this.broken=!0),!(s>h)){var l=n*a/2*o,c=e*a/2*o;t.x+=l,t.y+=c,i.x-=l,i.y-=c}}}this.canvas=t,this.context=t.getContext("2d"),this.points=[],this.paused=!0,scaleCanvas(this.canvas,this.context);var n=t.clientWidth,e=t.clientHeight,h=this,o=400,a=1,l=.01,c=3,r=20,x=2e3,u=50,d=null,v=null,y=document.getElementById("pause"),p=document.getElementById("reset");y.addEventListener("click",function(){h.setPaused(!h.paused)}),p.addEventListener("click",function(){h.reset()}),this.setPaused=function(t){t&&!this.paused?clearInterval(this.runInterval):this.paused&&(this.runInterval=setInterval(function(){h.update(.015)},15)),this.paused=t,y.innerHTML=t?"Resume":"Pause"},this.getRelativeCoord=function(i){var s=t.getBoundingClientRect();return{x:i.clientX-s.left,y:i.clientY-s.top}},this.draw=function(){this.context.clearRect(0,0,this.canvas.clientWidth,this.canvas.clientHeight);for(var t=0;t<this.points.length;t++){for(var i=0;i<this.points[t].links.length;i++)this.context.beginPath(),this.context.moveTo(this.points[t].links[i].a.x,this.points[t].links[i].a.y),this.context.lineTo(this.points[t].links[i].b.x,this.points[t].links[i].b.y),this.context.closePath(),this.context.strokeStyle="#000000",this.context.stroke();this.context.beginPath(),this.context.arc(this.points[t].x,this.points[t].y,2,0,2*Math.PI),this.context.closePath(),this.context.fillStyle="#000000",this.context.fill()}d&&(this.context.globalAlpha=.2,this.context.beginPath(),this.context.arc(d.x,d.y,r,0,2*Math.PI),this.context.closePath(),this.context.fillStyle="#0000FF",this.context.fill(),this.context.globalAlpha=1)},this.update=function(t){for(var i=0;c>i;i++)for(var s=0;s<this.points.length;s++)this.points[s].constraints();this.points.forEach(function(i){i.update(t)}),this.draw()},this.reset=function(){this.points=[],this.initializePoints()},this.initializePoints=function(){for(var t=20,s=20,n=8,e=8,h=0,o=0;s>o;o++)for(var a=0;t>a;a++)this.points[h]=new i(a*n+u,o*e+u,0==o),a>0&&this.points[h].attachTo(this.points[h-1]),o>0&&this.points[h].attachTo(this.points[h-t]),h++},this.initializePoints(),t.addEventListener("mousedown",function(t){var i=h.getRelativeCoord(t);d&&(v={x:i.x-d.x,y:i.y-d.y}),d=i}),t.addEventListener("mousemove",function(t){if(d){var i=h.getRelativeCoord(t);v={x:i.x-d.x,y:i.y-d.y},d=i}}),t.addEventListener("mouseup",function(t){d=v=null}),t.addEventListener("mouseleave",function(t){d=v=null})}function scaleCanvas(t,i){var s=window.devicePixelRatio||1,n=i.webkitBackingStorePixelRatio||i.mozBackingStorePixelRatio||i.msBackingStorePixelRatio||i.oBackingStorePixelRatio||i.backingStorePixelRatio||1,e=s/n;t.style.width=t.width+"px",t.style.height=t.height+"px",t.width*=e,t.height*=e,i.scale(e,e)}var cloth;window.onload=function(){var t=document.getElementById("drawCanvas");cloth=new Cloth(t),cloth.setPaused(!1)};