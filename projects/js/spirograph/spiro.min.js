window.onload=function(){function e(){scaleCanvas(u,h),scaleCanvas(p,v);var e=$("canvases");fitElement(e,e.clientWidth,e.clientHeight,function(t){u.style.width=p.style.width=e.style.width,u.style.height=p.style.height=e.style.height}),linkInputToNumber(k.speedInput,g,"speed"),linkInputToNumber(k.iterInput,g,"iterations"),linkInputToNumber(k.penDistInput,g,"penDist",n),linkCheckboxToBoolean(k.sccheck,g,"showCircles",n),linkCheckboxToBoolean(k.srcheck,g,"showRadii",n),linkCheckboxToBoolean(k.spcheck,g,"showPen",n),linkCheckboxToBoolean(k.uccheck,g,"useColor"),k.pauseBtn.addEventListener("click",function(){r(!m)}),k.resetBtn.addEventListener("click",function(){s()}),k.saveBtn.addEventListener("click",function(){k.saveImg.src=u.toDataURL()}),window.addEventListener("keydown",function(e){switch(e.keyCode){case 32:r(!m),e.preventDefault();break;case 39:i(1.1*g.speed),e.preventDefault();break;case 37:i(g.speed/1.1),e.preventDefault();break;case 187:a(g.iterations+10),e.preventDefault();break;case 189:a(g.iterations-10),e.preventDefault();break;case 13:s(),e.preventDefault()}}),o(),r(!1)}function t(e,t){e=e||function(){},t=t||function(){};for(var n,i=u.drawWidth/2,a=i,r=i,s=0,l=0,c=0,o=0;o<f.length;o++)n=f[o],l=s-n.angle,s+=(c/n.radius-1)*n.angle,o>0&&(a+=i*(c-n.radius)*Math.cos(l),r+=i*(c-n.radius)*Math.sin(l)),o==f.length-1&&(n.penx=a+n.radius*i*g.penDist*Math.cos(s),n.peny=r+n.radius*i*g.penDist*Math.sin(s)),n.x=a,n.y=r,n.realangle=s%(2*Math.PI),n.realradius=n.radius*i,e(n),c=n.radius;t(f[o-1])}function n(){v.clearRect(0,0,p.drawWidth,p.drawHeight),(g.showCircles||g.showRadii||g.showPen)&&t(function(e){g.showCircles&&(v.strokeStyle="#000000",v.beginPath(),v.arc(e.x,e.y,Math.abs(e.realradius),0,2*Math.PI),v.closePath(),v.stroke()),g.showRadii&&(v.strokeStyle="#00FF00",v.beginPath(),v.moveTo(e.x,e.y),v.lineTo(e.x+Math.cos(e.realangle)*e.realradius,e.y+Math.sin(e.realangle)*e.realradius),v.closePath(),v.stroke())},function(e){g.showPen&&(v.fillStyle="#FF0000",v.beginPath(),v.arc(e.penx,e.peny,2,0,360),v.closePath(),v.fill())})}function i(e){0>=e||(g.speed=e,k.speedInput.valueAsNumber=e)}function a(e){0>=e||(g.iterations=e,k.iterInput.valueAsNumber=e)}function r(e){e&&!m?clearInterval(d):m&&(d=setInterval(function(){b(.015)},15)),m=e,k.pauseBtn.innerHTML=e?"Resume":"Pause"}function s(){f.forEach(function(e){e.angle=0}),h.clearRect(0,0,u.drawWidth,u.drawHeight),n()}function l(e){var t=f.indexOf(e);f.splice(t,1),o(),n()}function c(e){var t=e>0?f[e-1].radius/2:1,i=e>0?f[e-1].speed/2||1:0,a={radius:t,angle:0,speed:i};f.splice(e,0,a),o(),n()}function o(){for(;k.circleDiv.firstChild;)k.circleDiv.removeChild(k.circleDiv.firstChild);for(var e,t=0;t<f.length;t++){var i=f[t];if(e=document.createElement("button"),e.innerHTML="+",e.addEventListener("click",c.bind(null,t)),e.style.width="100%",i.div)i.div.getElementsByTagName("div")[0].innerHTML="Circle "+t+":";else{var a=document.createElement("div"),r=document.createElement("div");r.innerHTML="Circle "+t+":",r.style.textAlign="center";var s=document.createElement("div"),o=document.createElement("input");o.setAttribute("type","number"),o.setAttribute("step","0.05"),o.style["float"]="right",linkInputToNumber(o,i,"radius",n);var d=document.createElement("br");d.style.clear="right",s.innerHTML="Radius: ",s.appendChild(o),s.appendChild(d);var u=document.createElement("div"),p=document.createElement("input");p.setAttribute("type","number"),p.setAttribute("step","0.01"),p.style["float"]="right",linkInputToNumber(p,i,"speed",n),d=document.createElement("br"),d.style.clear="right",u.innerHTML="Speed: ",u.appendChild(p),u.appendChild(d);var h=document.createElement("button");h.innerHTML="delete",h.addEventListener("click",l.bind(null,i)),h.style.width="100%",a.appendChild(r),a.appendChild(s),a.appendChild(u),a.appendChild(h),a.style.border="2px solid black",a.style.padding="4px",a.style.margin="10px",i.div=a}k.circleDiv.appendChild(e),k.circleDiv.appendChild(i.div)}e=document.createElement("button"),e.innerHTML="+",e.addEventListener("click",c.bind(null,f.length)),e.style.width="100%",k.circleDiv.appendChild(e)}var d,u=$("spiro-canvas"),p=$("info-canvas"),h=u.getContext("2d"),v=p.getContext("2d"),f=[{radius:1,angle:0,speed:0},{radius:.5,angle:0,speed:1},{radius:.25,angle:0,speed:1/Math.PI}],m=!0,g={iterations:100,speed:5,penDist:0,showCircles:!0,showRadii:!1,showPen:!0,useColor:!0},k={speedInput:$("speed-input"),iterInput:$("iter-input"),penDistInput:$("pendist-input"),sccheck:$("show-circles"),srcheck:$("show-radii"),spcheck:$("show-pen"),uccheck:$("use-color"),pauseBtn:$("pause-btn"),resetBtn:$("reset-btn"),circleDiv:$("circles"),saveBtn:$("save-btn"),saveImg:$("save-img")};e();var b=function(){var e,i,a,r,s,l,c,o=function(t){e=t.penx,i=t.peny},d=function(e){e.angle+=g.speed*e.speed*c},u=function(e){a=e.penx,r=e.peny,s=e.realradius,l=e.realangle};return function(s){c=s/g.iterations,t(null,o);for(var p=0;p<g.iterations;p++)f.forEach(d),t(null,u),h.strokeStyle=g.useColor?getSaturatedColor(l/(2*Math.PI)):"#000000",h.beginPath(),h.moveTo(e,i),h.lineTo(a,r),h.closePath(),h.stroke(),e=a,i=r;n()}}()};